{% import 'PimUIBundle:Default:page_elements.html.twig' as elements %}

{% block content %}
    <div class="AknDefault-mainContent">
        {{ elements.page_header(
            {
                title: 'pim_analytics.changelog.title'|trans,
                buttons: buttons
            }
        ) }}

        {% for version in changelog.versions %}
            {% if version.date %}
                <h3>{{ version.name }} - {{ version.date.format('Y-m-d') }}</h3>
                {% for section, changes in version.changes %}
                    <h4>{{ section }}</h4>
                    {% for fix in changes %}
                        <p>
                        <pre>{{ fix }}</pre></p>
                    {% endfor %}
                {% endfor %}
                <hr/>
            {% endif %}
        {% endfor %}
    </div>

    <script>
        require(
            [
                'pim/common/breadcrumbs',
                'pim/fetcher-registry',
                'pim/form-builder'
            ],
            function (
                Breadcrumbs,
                FetcherRegistry,
                FormBuilder
            ) {
                $(function () {
                    var breadcrumbs = new Breadcrumbs({
                        config: {
                            tab: 'pim-menu-system',
                            item: 'pim-menu-changelog'
                        }
                    });
                    breadcrumbs.configure().then(function () {
                        breadcrumbs.render();
                        $('*[data-drop-zone="breadcrumbs"]').append(breadcrumbs.$el);
                    });

                    FetcherRegistry.initialize().done(function () {
                        FormBuilder.build('pim-menu-user-navigation').then(function (form) {
                            $('.user-menu').append(form.el);
                            form.render();
                        }.bind(this));
                    });
                });
            }
        );
    </script>
{% endblock %}
